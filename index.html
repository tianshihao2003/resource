<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Drive é£æ ¼ Â· æˆ‘çš„èµ„æºåº“</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* å¾®è°ƒï¼Œè®©ç•Œé¢æ›´åƒ Drive é£æ ¼ */
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .appbar { height:64px; }
    .sidebar { width:240px; }
    .card-hover:hover { box-shadow: 0 6px 18px rgba(13, 17, 23, 0.08); transform: translateY(-2px); }
    .modal-backdrop { background: rgba(0,0,0,0.55); }
    .truncate-2 { display: -webkit-box; -webkit-line-clamp:2; -webkit-box-orient: vertical; overflow: hidden; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-900">

<!-- å¯†ç é—¨ï¼ˆä¿ç•™ï¼‰ -->
<div id="pwGate" style="display:flex; align-items:center; justify-content:center; position:fixed; inset:0; z-index:60;">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div class="relative z-10 bg-white rounded-lg shadow-lg p-6 w-[420px]">
    <div class="flex items-center gap-4 mb-4">
      <img src="/mnt/data/6629db86-c4a6-4b32-a321-973962865e0d.png" alt="logo" class="w-12 h-12 rounded border" onerror="this.style.display='none'">
      <div>
        <h2 class="text-lg font-semibold">è¯·è¾“å…¥è®¿é—®å¯†ç </h2>
        <p class="text-sm text-gray-500">è¾“å…¥æ­£ç¡®å¯†ç åå³å¯è¿›å…¥ä½ çš„èµ„æºåº“ï¼ˆå®¢æˆ·ç«¯ç®€å•é—¨ï¼‰ã€‚</p>
      </div>
    </div>
    <input id="passwordInput" type="password" placeholder="è¾“å…¥å¯†ç " class="w-full border rounded px-3 py-2 mb-3" />
    <div class="flex items-center justify-between">
      <label class="text-sm text-gray-600 flex items-center gap-2"><input id="remember" type="checkbox"> è®°ä½æˆ‘</label>
      <div class="flex gap-2">
        <button id="pwCancel" class="px-3 py-2 border rounded">å–æ¶ˆ</button>
        <button id="pwSubmit" class="bg-blue-600 text-white px-4 py-2 rounded">è¿›å…¥</button>
      </div>
    </div>
    <p id="pwError" class="text-sm text-red-600 mt-3" style="display:none"></p>
  </div>
</div>

<!-- åº”ç”¨ä¸»ä½“ -->
<div id="app" style="display:none">
  <!-- Appbar -->
  <header class="appbar bg-white shadow-sm flex items-center px-4">
    <div class="flex items-center gap-4">
      <button id="hamburger" class="p-2 rounded hover:bg-gray-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>
      <img src="/mnt/data/6629db86-c4a6-4b32-a321-973962865e0d.png" alt="logo" class="w-9 h-9 rounded" onerror="this.style.display='none'">
      <div class="ml-1">
        <div class="text-sm font-semibold">æˆ‘çš„èµ„æºåº“</div>
        <div class="text-xs text-gray-500">tianshihao2003 / resource</div>
      </div>
    </div>

    <div class="flex-1 px-6">
      <div class="relative">
        <input id="search" class="w-full border rounded-full px-4 py-2 pl-10 text-sm" placeholder="æœç´¢æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼ˆæŒ‰åå­—ï¼‰" />
        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</div>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <button id="viewToggle" class="px-3 py-2 border rounded text-sm">ç½‘æ ¼</button>
      <button id="refreshBtn" class="px-3 py-2 border rounded text-sm">åˆ·æ–°</button>
      <div class="flex items-center gap-2">
        <button class="w-9 h-9 rounded-full bg-gray-200 flex items-center justify-center text-sm">TS</button>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- sidebar -->
    <aside id="sidebar" class="sidebar bg-white border-r p-4 hidden sm:block">
      <nav class="space-y-2">
        <button class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-50 text-sm font-medium">ğŸ“ æˆ‘çš„äº‘ç›˜</button>
        <button class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-50 text-sm">â­ æ”¶è—</button>
        <button class="w-full flex items-center gap-3 p-2 rounded hover:bg-gray-50 text-sm">ğŸ•˜ æœ€è¿‘</button>
      </nav>
      <div class="mt-6 text-xs text-gray-500">æç¤ºï¼šé™æ€ç‰ˆæœ¬ä¼šè°ƒç”¨ GitHub å…¬å…± APIã€‚</div>
    </aside>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="flex-1 p-6">
      <!-- toolbar -->
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <nav id="breadcrumbs" class="text-sm text-gray-600"></nav>
        </div>
        <div class="flex items-center gap-2">
          <select id="sortSelect" class="border rounded px-2 py-1 text-sm">
            <option value="name">æŒ‰åç§°</option>
            <option value="type">æŒ‰ç±»å‹</option>
          </select>
          <button id="newFolder" class="px-3 py-2 bg-green-600 text-white rounded text-sm">æ–°å»ºæ–‡ä»¶å¤¹</button>
        </div>
      </div>

      <!-- content list/grid -->
      <div id="contentArea">
        <div id="listingGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        <div id="listingList" class="hidden"></div>
        <div id="empty" class="text-center text-gray-500 py-10 hidden">æ­¤ç›®å½•ä¸ºç©ºã€‚</div>
      </div>
    </main>
  </div>
</div>

<!-- é¢„è§ˆæ¨¡æ€ -->
<div id="previewModal" class="fixed inset-0 flex items-center justify-center" style="display:none; z-index:80;">
  <div class="absolute inset-0 modal-backdrop"></div>
  <div class="relative z-10 bg-white rounded shadow p-4 max-w-3xl w-full max-h-[85vh] overflow-auto">
    <div class="flex justify-between items-center mb-3">
      <div id="previewTitle" class="font-medium"></div>
      <div class="flex gap-2">
        <a id="previewOpenNew" class="underline text-sm" target="_blank" rel="noreferrer">åœ¨æ–°çª—å£æ‰“å¼€</a>
        <button id="previewClose" class="px-3 py-1 border rounded">å…³é—­</button>
      </div>
    </div>
    <div id="previewContent"></div>
  </div>
</div>

<script>
/* Drive é£æ ¼ UI + åŠŸèƒ½å®ç°ï¼ˆé™æ€å‰ç«¯ç‰ˆï¼‰
   - å¯†ç ï¼ˆå®¢æˆ·ç«¯ï¼‰ä»ä¸º 0824
   - ä½¿ç”¨ä½ çš„å…¬å¼€ä»“åº“ GitHub API åˆ—è¡¨
   - Grid / List view åˆ‡æ¢ã€æœç´¢ã€é¢„è§ˆ
*/
const PASSWORD = '0824';
const STORAGE_KEY = 'repo_unlocked_v1';
const OWNER = 'tianshihao2003';
const REPO = 'resource';
const API_BASE = `https://api.github.com/repos/${OWNER}/${REPO}/contents/`;

// DOM
const pwGate = document.getElementById('pwGate');
const passwordInput = document.getElementById('passwordInput');
const pwSubmit = document.getElementById('pwSubmit');
const pwCancel = document.getElementById('pwCancel');
const pwError = document.getElementById('pwError');
const rememberCb = document.getElementById('remember');
const app = document.getElementById('app');
const searchInput = document.getElementById('search');
const refreshBtn = document.getElementById('refreshBtn');
const viewToggle = document.getElementById('viewToggle');
const listingGrid = document.getElementById('listingGrid');
const listingList = document.getElementById('listingList');
const emptyEl = document.getElementById('empty');
const breadcrumbsEl = document.getElementById('breadcrumbs');
const previewModal = document.getElementById('previewModal');
const previewContent = document.getElementById('previewContent');
const previewTitle = document.getElementById('previewTitle');
const previewOpenNew = document.getElementById('previewOpenNew');
const previewClose = document.getElementById('previewClose');
const hamburger = document.getElementById('hamburger');
const sidebar = document.getElementById('sidebar');

let currentPath = '';
let currentItems = [];
let viewMode = 'grid'; // grid or list

function setUnlocked(remember) {
  try { localStorage.setItem(STORAGE_KEY, '1'); } catch(e){}
}
function isUnlocked() { try { return localStorage.getItem(STORAGE_KEY) === '1'; } catch(e) { return false; } }

function showGate() { pwError.style.display='none'; passwordInput.value=''; pwGate.style.display='flex'; app.style.display='none'; setTimeout(()=>passwordInput.focus(),50); }
function hideGate() { pwGate.style.display='none'; app.style.display='block'; }

function tryPassword(remember){ const v=(passwordInput.value||'').trim(); if(!v){ pwError.textContent='è¯·è¾“å…¥å¯†ç '; pwError.style.display='block'; return; } if(v===PASSWORD){ setUnlocked(remember); hideGate(); initApp(); } else { pwError.textContent='å¯†ç é”™è¯¯'; pwError.style.display='block'; } }

pwCancel.onclick = ()=>{ passwordInput.value=''; pwError.style.display='none'; };
pwSubmit.onclick = ()=> tryPassword(rememberCb.checked);
passwordInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') tryPassword(rememberCb.checked); });

if(isUnlocked()){ hideGate(); setTimeout(()=>initApp(),50); } else { showGate(); }

/* Utility */
function niceSize(bytes){ if(bytes===0) return '0B'; if(!bytes && bytes!==0) return '-'; const u=['B','KB','MB','GB']; let i=0,n=bytes; while(n>=1024&&i<u.length-1){n/=1024;i++;} return Math.round(n*10)/10+u[i]; }
function iconFor(name,type){ if(type==='dir') return 'ğŸ“'; const ext=(name.split('.').pop()||'').toLowerCase(); if(['png','jpg','jpeg','gif','webp','svg'].includes(ext)) return 'ğŸ–¼ï¸'; if(['mp4','mov','webm','mkv'].includes(ext)) return 'ğŸï¸'; if(['mp3','wav','ogg'].includes(ext)) return 'ğŸµ'; if(['pdf'].includes(ext)) return 'ğŸ“•'; if(['zip','tar','gz','rar'].includes(ext)) return 'ğŸ—œï¸'; return 'ğŸ“„'; }

/* Fetch contents */
async function fetchContents(path){ const url = API_BASE + encodeURIComponent(path).replace(/%2F/g,'/'); const res = await fetch(url,{ headers:{ Accept:'application/vnd.github.v3+json' } }); if(res.status===404) throw new Error('è·¯å¾„ä¸å­˜åœ¨æˆ–ä»“åº“ä¸å¯è®¿é—®ï¼ˆå¯èƒ½æ˜¯ç§æœ‰ä»“åº“ï¼‰ã€‚'); if(res.status===403) throw new Error('è®¿é—®è¢«é™åˆ¶ï¼šå¯èƒ½è§¦å‘ GitHub API é™åˆ¶ã€‚'); if(!res.ok) throw new Error('GitHub API é”™è¯¯ï¼š'+res.status); return res.json(); }

async function loadPath(path){ currentPath = path||''; try{ listingGrid.innerHTML=''; listingList.innerHTML=''; emptyEl.classList.add('hidden'); document.getElementById('error')?.remove(); const data = await fetchContents(path); const arr = Array.isArray(data)?data:[data]; arr.sort((a,b)=> a.type===b.type? a.name.localeCompare(b.name) : a.type==='dir' ? -1:1); currentItems = arr; renderBreadcrumbs(); renderItems(); }catch(e){ showError(e.message||'åŠ è½½å¤±è´¥'); currentItems=[]; listingGrid.innerHTML=''; listingList.innerHTML=''; }
}

function showError(msg){ const el = document.getElementById('error') || document.createElement('div'); el.id='error'; el.className='text-red-600 mb-3'; el.textContent=msg; const main = document.querySelector('main'); if(main) main.prepend(el); }

function renderBreadcrumbs(){ const parts = currentPath? currentPath.split('/').filter(Boolean):[]; const crumbs=[{name:'æˆ‘çš„äº‘ç›˜', path:''}, ...parts.map((p,i)=>({name:p,path:parts.slice(0,i+1).join('/')}))]; breadcrumbsEl.innerHTML = crumbs.map((c,i)=>`<button data-path="${c.path}" class="text-sm text-gray-600 hover:underline mr-2">${c.name}${i<crumbs.length-1?' /':''}</button>`).join(''); breadcrumbsEl.querySelectorAll('button[data-path]').forEach(btn=>btn.onclick=()=>loadPath(btn.dataset.path)); }

function renderItems(){ listingGrid.innerHTML=''; listingList.innerHTML=''; if(!currentItems||currentItems.length===0){ emptyEl.classList.remove('hidden'); return; } emptyEl.classList.add('hidden');
  for(const item of currentItems){ const name = item.name; const size = item.size; const type = item.type; const icon = iconFor(name,type);
    // grid card
    const card = document.createElement('div'); card.className='bg-white p-4 rounded card-hover hover:shadow-md';
    card.innerHTML = `
      <div class="flex flex-col h-full">
        <div class="flex items-start justify-between">
          <div class="text-4xl">${icon}</div>
          <div class="text-xs text-gray-500">${type==='dir'?'æ–‡ä»¶å¤¹':(size?niceSize(size):'-')}</div>
        </div>
        <div class="mt-3 flex-1">
          <div class="font-medium truncate">${name}</div>
          <div class="text-xs text-gray-500 mt-1 truncate">${item.path||''}</div>
        </div>
        <div class="mt-3 flex items-center justify-between text-xs">
          <div class="flex gap-2">
            ${item.download_url?`<a href="${item.download_url}" target="_blank" rel="noreferrer" class="underline">ä¸‹è½½</a>`:''}
            ${item.html_url?`<a href="${item.html_url}" target="_blank" rel="noreferrer" class="underline">åœ¨ GitHub æŸ¥çœ‹</a>`:''}
          </div>
          ${item.type==='dir'?`<button data-path="${item.path}" class="open-btn px-2 py-1 border rounded text-xs">æ‰“å¼€</button>`:`<button data-path="${item.path}" class="preview-btn px-2 py-1 border rounded text-xs">é¢„è§ˆ</button>`}
        </div>
      </div>
    `;
    listingGrid.appendChild(card);

    // list row
    const row = document.createElement('div'); row.className='bg-white p-3 rounded flex items-center justify-between gap-3';
    row.innerHTML = `
      <div class="flex items-center gap-3">
        <div class="text-2xl">${icon}</div>
        <div>
          <div class="font-medium">${name}</div>
          <div class="text-xs text-gray-500">${item.path||''}</div>
        </div>
      </div>
      <div class="flex items-center gap-4 text-xs text-gray-500">
        <div>${type==='dir'?'æ–‡ä»¶å¤¹':(size?niceSize(size):'-')}</div>
        <div class="flex gap-2">
          ${item.download_url?`<a href="${item.download_url}" target="_blank" rel="noreferrer" class="underline">ä¸‹è½½</a>`:''}
          ${item.html_url?`<a href="${item.html_url}" target="_blank" rel="noreferrer" class="underline">åœ¨ GitHub æŸ¥çœ‹</a>`:''}
          ${item.type==='dir'?`<button data-path="${item.path}" class="open-btn px-2 py-1 border rounded text-xs">æ‰“å¼€</button>`:`<button data-path="${item.path}" class="preview-btn px-2 py-1 border rounded text-xs">é¢„è§ˆ</button>`}
        </div>
      </div>
    `;
    listingList.appendChild(row);
  }
  attachItemHandlers();
}

function attachItemHandlers(){ document.querySelectorAll('.open-btn').forEach(b=>b.onclick=()=>{ const p=b.getAttribute('data-path'); const normalized = p.replace(new RegExp(`^${OWNER}/${REPO}/?`),'').replace(/^\/+|\/+$/g,''); loadPath(normalized); }); document.querySelectorAll('.preview-btn').forEach(b=>b.onclick=async()=>{ const p=b.getAttribute('data-path'); const item = currentItems.find(x=>x.path===p||x.name===p); if(!item) return; if(/\.(png|jpg|jpeg|gif|webp|svg)$/i.test(item.name)){ showPreviewImage(item.download_url,item.name); } else { try{ showPreviewLoading(); const r = await fetch(item.download_url); const txt = await r.text(); showPreviewText(txt,item.name); }catch(e){ showPreviewText('æ— æ³•åŠ è½½ï¼š'+(e.message||e),item.name); } } }); }

function showPreviewLoading(){ previewTitle.textContent='åŠ è½½ä¸­...'; previewContent.innerHTML='<div class="text-center py-10 text-gray-600">åŠ è½½ä¸­â€¦</div>'; previewOpenNew.style.display='none'; previewModal.style.display='flex'; }
function showPreviewImage(src,name){ previewTitle.textContent=name; previewContent.innerHTML=`<img src="${src}" alt="${name}" class="max-h-[70vh] mx-auto"/>`; previewOpenNew.href=src; previewOpenNew.style.display='inline'; previewModal.style.display='flex'; }
function showPreviewText(text,name){ previewTitle.textContent=name; previewContent.innerHTML=`<pre class="whitespace-pre-wrap text-sm bg-gray-100 p-3 rounded max-h-[70vh] overflow-auto">${escapeHtml(text)}</pre>`; previewOpenNew.style.display='none'; previewModal.style.display='flex'; }
function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

previewClose.onclick = ()=>{ previewModal.style.display='none'; previewContent.innerHTML=''; }

// search
searchInput.addEventListener('input', (e)=>{ const q=e.target.value.trim().toLowerCase(); if(!currentItems) return; if(!q) { renderItems(); return; } const filtered = currentItems.filter(i=>i.name.toLowerCase().includes(q)); const saved = currentItems; currentItems = filtered; renderItems(); currentItems = saved; });

// view toggle
viewToggle.onclick = ()=>{ viewMode = viewMode==='grid'?'list':'grid'; if(viewMode==='grid'){ listingGrid.classList.remove('hidden'); listingList.classList.add('hidden'); viewToggle.textContent='ç½‘æ ¼'; } else { listingGrid.classList.add('hidden'); listingList.classList.remove('hidden'); viewToggle.textContent='åˆ—è¡¨'; } };

// refresh
refreshBtn.onclick = ()=> loadPath(currentPath);

// hamburger (mobile)
hamburger.onclick = ()=>{ if(sidebar.style.display==='block') sidebar.style.display='none'; else sidebar.style.display='block'; };

// initial load
function initApp(){ app.style.display='block'; loadPath(''); }

</script>
</body>
</html>
